<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eta.util.general &mdash; eta-py 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/my_theme.css?v=5df1763a" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            eta-py
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/eta.html">Eta documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">eta-py</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">eta.util.general</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for eta.util.general</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Generic utility functions for various basic data types.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="kn">from</span> <span class="nn">eta.constants</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">eta.util.file</span> <span class="k">as</span> <span class="nn">file</span>

<span class="c1"># ``````````````````````````````````````</span>
<span class="c1"># &quot;Symbol&quot; util</span>
<span class="c1"># ``````````````````````````````````````</span>

<div class="viewcode-block" id="clear_symtab">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.clear_symtab.html#eta.util.general.clear_symtab">[docs]</a>
<span class="k">def</span> <span class="nf">clear_symtab</span><span class="p">():</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Clear the symbol table used for creating new symbols.&quot;&quot;&quot;</span>
	<span class="n">file</span><span class="o">.</span><span class="n">ensure_file_exists</span><span class="p">(</span><span class="n">SYMTAB_PATH</span><span class="p">)</span>
	<span class="n">file</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">SYMTAB_PATH</span><span class="p">,</span> <span class="p">{})</span></div>



<div class="viewcode-block" id="gentemp">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.gentemp.html#eta.util.general.gentemp">[docs]</a>
<span class="k">def</span> <span class="nf">gentemp</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Generate a unique symbol that hasn&#39;t been used before by appending an integer suffix i and then incrementing i.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	str : str</span>
<span class="sd">		String to use for symbol generation.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	str</span>
<span class="sd">		A &quot;symbol&quot; with a unique integer suffix attached to the given string.</span>

<span class="sd">	Notes</span>
<span class="sd">	-----</span>
<span class="sd">	This currently relies on an external symbol table stored in a file, which</span>
<span class="sd">	exploits the fact that race conditions with a shared file cannot occur with Python multiprocess</span>
<span class="sd">	(see: https://superfastpython.com/multiprocessing-race-condition-python/#Race_Condition_With_Shared_Data-2)</span>
<span class="sd">	However, this is somewhat clumsy/inefficient and should eventually be replaced by a proper solution.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">symtab</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">SYMTAB_PATH</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span> <span class="ow">in</span> <span class="n">symtab</span><span class="p">:</span>
		<span class="n">symtab</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">symtab</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="n">file</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">SYMTAB_PATH</span><span class="p">,</span> <span class="n">symtab</span><span class="p">)</span>
	<span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">str</span><span class="si">}{</span><span class="n">symtab</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span></div>



<div class="viewcode-block" id="episode_name">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.episode_name.html#eta.util.general.episode_name">[docs]</a>
<span class="k">def</span> <span class="nf">episode_name</span><span class="p">():</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Generate a new episode name.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">gentemp</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="episode_var">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.episode_var.html#eta.util.general.episode_var">[docs]</a>
<span class="k">def</span> <span class="nf">episode_var</span><span class="p">():</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Generate a new episode variable.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">gentemp</span><span class="p">(</span><span class="s1">&#39;?e&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="escaped_symbol_p">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.escaped_symbol_p.html#eta.util.general.escaped_symbol_p">[docs]</a>
<span class="k">def</span> <span class="nf">escaped_symbol_p</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Check if a given symbol is an &quot;escaped&quot; symbol, equivalent to vertical bars in LISP.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span></div>



<div class="viewcode-block" id="symbolp">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.symbolp.html#eta.util.general.symbolp">[docs]</a>
<span class="k">def</span> <span class="nf">symbolp</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Check if a given variable is a &quot;symbol&quot; (i.e., a string).&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></div>



<div class="viewcode-block" id="variablep">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.variablep.html#eta.util.general.variablep">[docs]</a>
<span class="k">def</span> <span class="nf">variablep</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Check if a given input is a variable symbol, i.e., starts with &#39;?&#39; or &#39;!&#39;.</span>
<span class="sd">	</span>
<span class="sd">	Notes</span>
<span class="sd">	-----</span>
<span class="sd">	For now, this excludes indexical variables, such as &#39;^you&#39;.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">symbolp</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">]</span></div>



<div class="viewcode-block" id="dual_var">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.dual_var.html#eta.util.general.dual_var">[docs]</a>
<span class="k">def</span> <span class="nf">dual_var</span><span class="p">(</span><span class="n">ep_var</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Given an episode variable like ?e1, return the non-fluent dual of that variable, e.g., !e1 (and vice-versa).&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">variablep</span><span class="p">(</span><span class="n">ep_var</span><span class="p">):</span>
		<span class="k">return</span> <span class="s1">&#39;!&#39;</span><span class="o">+</span><span class="n">ep_var</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">ep_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span> <span class="k">else</span> <span class="s1">&#39;?&#39;</span><span class="o">+</span><span class="n">ep_var</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s1">&#39;&#39;</span></div>

	

<div class="viewcode-block" id="duplicate_var">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.duplicate_var.html#eta.util.general.duplicate_var">[docs]</a>
<span class="k">def</span> <span class="nf">duplicate_var</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Duplicate a variable by generating a new variable symbol with the initial variable (excluding trailing numbers) as a prefix.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">variablep</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">var</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">gentemp</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">))</span></div>



<span class="c1"># ``````````````````````````````````````</span>
<span class="c1"># String util</span>
<span class="c1"># ``````````````````````````````````````</span>


<div class="viewcode-block" id="replaceall">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.replaceall.html#eta.util.general.replaceall">[docs]</a>
<span class="k">def</span> <span class="nf">replaceall</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">replist</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Make a list of replacements to a given string in sequence.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	str : str</span>
<span class="sd">		A string whose contents should be replaced.</span>
<span class="sd">	replist : list[tuple]</span>
<span class="sd">		A list of replacements to make. A replacement is a tuple of one of the following forms:</span>
<span class="sd">			- ``(old, new)``</span>
<span class="sd">			- ``(old, new, is_regex)``</span>
<span class="sd">		If is_regex is given as True for a tuple, the old and new values are interpreted as regex strings.</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	str</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">replist</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">is_regex</span> <span class="o">=</span> <span class="n">tup</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">tup</span>
			<span class="n">is_regex</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="n">is_regex</span><span class="p">:</span>
			<span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">str</span></div>



<div class="viewcode-block" id="indent">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.indent.html#eta.util.general.indent">[docs]</a>
<span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Indent a string some number of levels.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="s2">&quot;  &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="standardize">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.standardize.html#eta.util.general.standardize">[docs]</a>
<span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">remove_parentheticals</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Standardize a string by applying a series of transformations.</span>
<span class="sd">	</span>
<span class="sd">	Specifically:</span>

<span class="sd">		1. Replace -- with -, and _ with whitespace.</span>
<span class="sd">		2. Remove parenthetical content (i.e., [...] or *...*), if `remove_parentheticals` is True.</span>
<span class="sd">		3. Add whitespace around all punctuation.</span>
<span class="sd">		4. Collapse all whitespace to a single space.</span>
<span class="sd">		5. Convert to lowercase.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">remove_parentheticals</span><span class="p">:</span>
		<span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[[a-zA-Z0-9\s]*\]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
		<span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\*[a-zA-Z0-9\s]*\*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
	<span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([.|,|!|?|:|;|-])&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; \1 &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
	<span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\s]+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>



<div class="viewcode-block" id="isquote">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.isquote.html#eta.util.general.isquote">[docs]</a>
<span class="k">def</span> <span class="nf">isquote</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Check if a given input is a quoted expression.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span></div>




<span class="c1"># ``````````````````````````````````````</span>
<span class="c1"># List util</span>
<span class="c1"># ``````````````````````````````````````</span>



<div class="viewcode-block" id="rec_replace">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.rec_replace.html#eta.util.general.rec_replace">[docs]</a>
<span class="k">def</span> <span class="nf">rec_replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Recursively replace some old value with a new value throughout a list.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">lst</span> <span class="o">==</span> <span class="n">old</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">new</span>

	<span class="n">new_lst</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="n">old</span><span class="p">:</span>
			<span class="n">new_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
			<span class="n">new_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec_replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">new_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">new_lst</span></div>



<div class="viewcode-block" id="rec_remove">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.rec_remove.html#eta.util.general.rec_remove">[docs]</a>
<span class="k">def</span> <span class="nf">rec_remove</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Recursively remove a given target from a list.&quot;&quot;&quot;</span>
	<span class="n">new_lst</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
			<span class="n">new_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec_remove</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">new_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">new_lst</span></div>



<div class="viewcode-block" id="listp">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.listp.html#eta.util.general.listp">[docs]</a>
<span class="k">def</span> <span class="nf">listp</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Check whether an input is a list (including the empty list).&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span></div>



<div class="viewcode-block" id="cons">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.cons.html#eta.util.general.cons">[docs]</a>
<span class="k">def</span> <span class="nf">cons</span><span class="p">(</span><span class="n">lst1</span><span class="p">,</span> <span class="n">lst2</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Insert a value to the front of a list or set.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	lst1 : object</span>
<span class="sd">		An object (possibly a sublist) to insert.</span>
<span class="sd">	lst2 : list[object], set[object], or object</span>
<span class="sd">		A list, set, or object to cons the given object to.</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	list[object] or set[object]</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">listp</span><span class="p">(</span><span class="n">lst2</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">lst1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lst2</span>
	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst2</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">{</span><span class="n">lst1</span><span class="p">}</span> <span class="o">|</span> <span class="n">lst2</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">lst1</span><span class="p">,</span> <span class="n">lst2</span><span class="p">]</span></div>

	

<div class="viewcode-block" id="push">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.push.html#eta.util.general.push">[docs]</a>
<span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="n">lst1</span><span class="p">,</span> <span class="n">lst2</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Insert a value to the end of a list or set.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	lst1 : object</span>
<span class="sd">		An object (possibly a sublist) to insert.</span>
<span class="sd">	lst2 : list[object], set[object], or object</span>
<span class="sd">		A list, set, or object to push the given object to.</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	list[object] or set[object]</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">listp</span><span class="p">(</span><span class="n">lst2</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">lst2</span> <span class="o">+</span> <span class="p">[</span><span class="n">lst1</span><span class="p">]</span>
	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst2</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">lst2</span> <span class="o">|</span> <span class="p">{</span><span class="n">lst1</span><span class="p">}</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">lst2</span><span class="p">,</span> <span class="n">lst1</span><span class="p">]</span></div>

	

<div class="viewcode-block" id="atom">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.atom.html#eta.util.general.atom">[docs]</a>
<span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Check whether an input is an atom (either empty list or a non-list).&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="ow">not</span> <span class="n">lst</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">listp</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span></div>



<div class="viewcode-block" id="append">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.append.html#eta.util.general.append">[docs]</a>
<span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Append each sublist within lst together, creating a single combined list.&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span></div>



<div class="viewcode-block" id="flatten">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.flatten.html#eta.util.general.flatten">[docs]</a>
<span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Recursively flatten a list, creating a single list with no sub-lists.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">listp</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="n">lst</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">append</span><span class="p">([</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">])</span></div>

	

<div class="viewcode-block" id="remove_duplicates">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.remove_duplicates.html#eta.util.general.remove_duplicates">[docs]</a>
<span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Remove duplicate items in a list, preserving the initial order of `order` is given as True.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">order</span><span class="p">:</span>
		<span class="n">visited</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">lst1</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
				<span class="n">lst1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
				<span class="n">visited</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">lst1</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span></div>

	

<div class="viewcode-block" id="remove_nil">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.remove_nil.html#eta.util.general.remove_nil">[docs]</a>
<span class="k">def</span> <span class="nf">remove_nil</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Remove any null values from a list.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span></div>

	

<div class="viewcode-block" id="subst">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.subst.html#eta.util.general.subst">[docs]</a>
<span class="k">def</span> <span class="nf">subst</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Recursively substitute b for a throughout a list.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">subst_rec</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">a</span>
		<span class="k">elif</span> <span class="n">atom</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">x</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">subst_rec</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">subst_rec</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lst</span><span class="p">)</span></div>



<div class="viewcode-block" id="substall">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.substall.html#eta.util.general.substall">[docs]</a>
<span class="k">def</span> <span class="nf">substall</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">replist</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Given a set of replacements, make a substitution in a list for each replacement.&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">replist</span><span class="p">:</span>
		<span class="n">lst</span> <span class="o">=</span> <span class="n">subst</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lst</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">lst</span></div>



<div class="viewcode-block" id="random_element">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.random_element.html#eta.util.general.random_element">[docs]</a>
<span class="k">def</span> <span class="nf">random_element</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Select a random element from a list.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_keyword_contents">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.get_keyword_contents.html#eta.util.general.get_keyword_contents">[docs]</a>
<span class="k">def</span> <span class="nf">get_keyword_contents</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Get the contents immediately following each keyword in `keys` from a list.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">e2</span> <span class="k">for</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span> <span class="k">if</span> <span class="n">e1</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="n">e2</span><span class="p">]</span></div>



<div class="viewcode-block" id="to_key">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.to_key.html#eta.util.general.to_key">[docs]</a>
<span class="k">def</span> <span class="nf">to_key</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Convert a list to a valid dict key consisting of only tuples and strings.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">lst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="kc">None</span>
	<span class="k">if</span> <span class="n">atom</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">to_key</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">])</span></div>

	

<div class="viewcode-block" id="split_by_cond">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.split_by_cond.html#eta.util.general.split_by_cond">[docs]</a>
<span class="k">def</span> <span class="nf">split_by_cond</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">cndfn</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Split a list by a given condition function.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	lst : list</span>
<span class="sd">	cndfn : function</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	filtered : list</span>
<span class="sd">		The input list with elements matching `cndfn` filtered out.</span>
<span class="sd">	matching : list</span>
<span class="sd">		A list of elements from the input list matching `cndfn`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">cndfn</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
	<span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">cndfn</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
	<span class="k">return</span> <span class="n">filtered</span><span class="p">,</span> <span class="n">matching</span></div>

	

<div class="viewcode-block" id="extract_category">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.extract_category.html#eta.util.general.extract_category">[docs]</a>
<span class="k">def</span> <span class="nf">extract_category</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">catfn</span><span class="p">,</span> <span class="n">ignfn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Recurse through a (possibly nested) list and extract categories that satisfy a given function.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	lst : s-expr</span>
<span class="sd">	catfn : function</span>
<span class="sd">		A function used to match categories to be extracted.</span>
<span class="sd">	ignfn : function, optional</span>
<span class="sd">		If given, a function used to ignore matching subexpressions (i.e.,</span>
<span class="sd">		avoid recursing within them).</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	lst_new : s-expr</span>
<span class="sd">		The input list with matching subexpressions removed.</span>
<span class="sd">	categories : list[s-expr]</span>
<span class="sd">		A list of extracted matching subexpressions.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">rec</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
		<span class="k">nonlocal</span> <span class="n">catfn</span><span class="p">,</span> <span class="n">ignfn</span>

		<span class="k">if</span> <span class="n">atom</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">lst</span><span class="p">,</span> <span class="p">[]</span>
		
		<span class="k">if</span> <span class="n">ignfn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ignfn</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
			<span class="n">no_sent_ops</span> <span class="o">=</span> <span class="n">lst</span>
			<span class="n">sent_ops</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">no_sent_ops</span><span class="p">,</span> <span class="n">sent_ops</span> <span class="o">=</span> <span class="n">split_by_cond</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">catfn</span><span class="p">)</span>
		
		<span class="n">recursed</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">no_sent_ops</span><span class="p">]</span>
		<span class="n">lst_new</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">recursed</span><span class="p">]</span>
		<span class="n">categories</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="n">sent_ops</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">recursed</span><span class="p">]))</span>
		<span class="k">return</span> <span class="n">lst_new</span><span class="p">,</span> <span class="n">categories</span>
	<span class="k">return</span> <span class="n">rec</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span></div>



<div class="viewcode-block" id="rec_find">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.rec_find.html#eta.util.general.rec_find">[docs]</a>
<span class="k">def</span> <span class="nf">rec_find</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="n">y</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Return subexpressions in a tree that are the same as the given symbol.</span>
<span class="sd">	</span>
<span class="sd">	A different binary function can be provided using the `test` argument.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">_</span><span class="p">,</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">extract_category</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">categories</span></div>



<div class="viewcode-block" id="rec_find_if">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.rec_find_if.html#eta.util.general.rec_find_if">[docs]</a>
<span class="k">def</span> <span class="nf">rec_find_if</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">cndfn</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Return subexpressions in a tree that satisfy `cndfn`.&quot;&quot;&quot;</span>
	<span class="n">_</span><span class="p">,</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">extract_category</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">cndfn</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">categories</span></div>




<span class="c1"># ``````````````````````````````````````</span>
<span class="c1"># Dict util</span>
<span class="c1"># ``````````````````````````````````````</span>



<div class="viewcode-block" id="dict_substall_keys">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.dict_substall_keys.html#eta.util.general.dict_substall_keys">[docs]</a>
<span class="k">def</span> <span class="nf">dict_substall_keys</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">replist</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Given a set of replacements, make a substitution to the keys in a dict for each replacement.&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">replist</span><span class="p">:</span>
		<span class="n">dct</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">a</span> <span class="k">if</span> <span class="n">var</span><span class="o">==</span><span class="n">b</span> <span class="k">else</span> <span class="n">var</span><span class="p">):</span><span class="n">val</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
	<span class="k">return</span> <span class="n">dct</span></div>



<div class="viewcode-block" id="cons_dict">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.cons_dict.html#eta.util.general.cons_dict">[docs]</a>
<span class="k">def</span> <span class="nf">cons_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Add `v` to the list at key `k` in `dct`, creating a new list if none exists.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
		<span class="n">dct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">dct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span></div>



<div class="viewcode-block" id="dict_get">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.dict_get.html#eta.util.general.dict_get">[docs]</a>
<span class="k">def</span> <span class="nf">dict_get</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Safe version of dict accessor that returns an empty list if key is not found.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[]</span></div>



<div class="viewcode-block" id="dict_rem_val">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.dict_rem_val.html#eta.util.general.dict_rem_val">[docs]</a>
<span class="k">def</span> <span class="nf">dict_rem_val</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Safe version of dict remove that removes val from the list stored at key (or pops the key if it stores an atom).&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
			<span class="n">dct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">dct</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>



<div class="viewcode-block" id="dict_rem">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.dict_rem.html#eta.util.general.dict_rem">[docs]</a>
<span class="k">def</span> <span class="nf">dict_rem</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Safe version of dict pop that removes a key from the dict.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
		<span class="n">dct</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>




<span class="c1"># ``````````````````````````````````````</span>
<span class="c1"># Number util</span>
<span class="c1"># ``````````````````````````````````````</span>



<div class="viewcode-block" id="squash">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.squash.html#eta.util.general.squash">[docs]</a>
<span class="k">def</span> <span class="nf">squash</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Squash each number within a vector to be within the given range.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">vector</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">vector</span>
	<span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">vector</span><span class="p">]</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
	<span class="n">mn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
	<span class="n">mx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
	<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="p">)</span>
	<span class="n">b</span> <span class="o">=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">mx</span><span class="p">)</span>
	<span class="k">return</span> <span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>



<div class="viewcode-block" id="normalize">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.normalize.html#eta.util.general.normalize">[docs]</a>
<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Normalize a vector to sum to 1.&quot;&quot;&quot;</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">v</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>



<div class="viewcode-block" id="linsum">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.linsum.html#eta.util.general.linsum">[docs]</a>
<span class="k">def</span> <span class="nf">linsum</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Compute a linear sum of a list of vectors, scaling each vector by the corresponding coefficient.&quot;&quot;&quot;</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
	<span class="n">vs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vectors</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vs</span><span class="p">):</span>
		<span class="n">r</span> <span class="o">+=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span>
	<span class="k">return</span> <span class="n">r</span></div>



<div class="viewcode-block" id="argmax">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.argmax.html#eta.util.general.argmax">[docs]</a>
<span class="k">def</span> <span class="nf">argmax</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;Select the n top values in a given list, according to a list of scores for each list element.&quot;&quot;&quot;</span>
	<span class="n">objs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
	<span class="n">scores_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">)[:</span><span class="o">-</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">objs</span><span class="p">[</span><span class="n">scores_top</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>



<div class="viewcode-block" id="certainty_to_period">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.certainty_to_period.html#eta.util.general.certainty_to_period">[docs]</a>
<span class="k">def</span> <span class="nf">certainty_to_period</span><span class="p">(</span><span class="n">certainty</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Map a certainty in [0,1] to a period (in seconds) that an expected event should occur within.</span>

<span class="sd">  The proportion between the period and the quantity ``-log(1 - certainty)`` is determined by the global</span>
<span class="sd">  constant EXPECTED_STEP_FAILURE_PERIOD_COEFFICIENT, defined in ``eta.constants``.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  certainty : float</span>
<span class="sd">    A certainty value in [0,1]</span>
<span class="sd">  </span>
<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  float or np.inf</span>
<span class="sd">    The period (in seconds), or infinity if the certainty is 1.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">certainty</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">certainty</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">EXPECTED_STEP_FAILURE_PERIOD_COEFFICIENT</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">certainty</span><span class="p">)</span></div>

  

<div class="viewcode-block" id="has_elapsed_certainty_period">
<a class="viewcode-back" href="../../../_autosummary/eta.util.general.has_elapsed_certainty_period.html#eta.util.general.has_elapsed_certainty_period">[docs]</a>
<span class="k">def</span> <span class="nf">has_elapsed_certainty_period</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">certainty</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Check whether a given time delta has elapsed the period corresponding to a given certainty.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  time : float</span>
<span class="sd">    The difference between two times (POSIX timestamps).</span>
<span class="sd">  certainty : float</span>
<span class="sd">    A certainty value in [0,1]</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  bool</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">certainty</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">certainty</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="kc">False</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">certainty_to_period</span><span class="p">(</span><span class="n">certainty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="n">period</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Benjamin Kane.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>